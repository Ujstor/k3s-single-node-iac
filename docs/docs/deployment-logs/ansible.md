```bash
ï² docker run --rm -it \
    -v $(pwd)/inventory.yml:/config/inventory.yml \
    -v $(pwd)/terraform/hetzner-node/.ssh/k3s_hetzner_key:/secrets/ssh_key \
    -v $(pwd)/terraform/hetzner-node/.ssh/k3s_hetzner_key.pub:/secrets/ssh_key.pub \
    ansible-k3s

root@0ffa9f2d3006:/ansible# cat /config/inventory.yml
---
server:
  hosts:
    api.k3s.ujstor.com:
  vars:
    k3s_version: v1.31.3+k3s1
    api_endpoint: "{{ groups['server'] | first }}"
    extra_server_args: >-
      --cluster-cidr=10.255.0.0/16
      --service-cidr=10.254.0.0/16
      --disable servicelb
      --disable traefik
      --flannel-backend=none
      --egress-selector-mode=disabled
      --disable-cloud-controller
      --disable-helm-controller
      --disable-network-policy
      --disable-kube-proxy
      --tls-san {{ api_endpoint }}

root@0ffa9f2d3006:/ansible# cat /secrets/ssh_key
-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----

root@0ffa9f2d3006:/ansible#
```

```bash
root@0ffa9f2d3006:/ansible# ansible-playbook k3s_deploy.yml

PLAY [Server prep] ******************************************************************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************************************************************************************
[WARNING]: Platform linux on host api.k3s.ujstor.com is using the discovered Python interpreter at /usr/bin/python3.11, but future installation of another Python interpreter could change the meaning of that path. See https://docs.ansible.com/ansible-core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [api.k3s.ujstor.com]

TASK [common : Update package lists] ************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [common : Upgrade all packages] ************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [common : Install public AuthorizedKeysFile] ***********************************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

TASK [common : Install required packages] *******************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [common : Enable UFW] **********************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [common : Allow incoming traffic on specified ports] ***************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com] => (item=22)
changed: [api.k3s.ujstor.com] => (item=80)
changed: [api.k3s.ujstor.com] => (item=443)
changed: [api.k3s.ujstor.com] => (item=6443)
changed: [api.k3s.ujstor.com] => (item=587)

TASK [common : Configure Fail2Ban] **************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [common : Restart fail2ban] ****************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [common : Ensure no conflicting PermitRootLogin in sshd_config] ****************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [common : SSH Hardening for root user] *****************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [common : Restart sshd] ********************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Enforce minimum Ansible version] *******************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [k3s.orchestration.prereq : Install Dependent Ubuntu Packages] *****************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Enable IPv4 forwarding] ****************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Enable IPv6 forwarding] ****************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Populate service facts] ****************************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Get ufw status] ************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : If ufw enabled, open api port] *********************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : If ufw enabled, open etcd ports] *******************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : If ufw enabled, allow default CIDRs] ***************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com] => (item=10.42.0.0/16)
skipping: [api.k3s.ujstor.com] => (item=10.43.0.0/16)
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : If firewalld enabled, open api port] ***************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : If firewalld enabled, open etcd ports] *************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : If firewalld enabled, open inter-node ports] *******************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com] => (item=5001/tcp)
skipping: [api.k3s.ujstor.com] => (item=8472/udp)
skipping: [api.k3s.ujstor.com] => (item=10250/tcp)
skipping: [api.k3s.ujstor.com] => (item=51820/udp)
skipping: [api.k3s.ujstor.com] => (item=51821/udp)
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : If firewalld enabled, allow node CIDRs] ************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com] => (item=159.69.83.103)
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : If firewalld enabled, allow default CIDRs] *********************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com] => (item=10.42.0.0/16)
skipping: [api.k3s.ujstor.com] => (item=10.43.0.0/16)
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Add br_netfilter to /etc/modules-load.d/] **********************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Load br_netfilter] *********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Set bridge-nf-call-iptables (just to be sure)] *****************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com] => (item=net.bridge.bridge-nf-call-iptables)
skipping: [api.k3s.ujstor.com] => (item=net.bridge.bridge-nf-call-ip6tables)
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Check for Apparmor existence] **********************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Check if Apparmor is enabled] **********************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Install Apparmor Parser [Suse]] ********************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Install Apparmor Parser [Debian]] ******************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Gather the package facts] **************************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : If iptables v1.8.0-1.8.4, warn user] ***************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Add /usr/local/bin to sudo secure_path] ************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Make rancher directory] ****************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Create symlink] ************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Make manifests directory] **************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Copy manifests] ************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Make k3s config directory] *************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.prereq : Copy config values] ********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [Generate random token] ********************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

TASK [Set token fact] ***************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

PLAY [Setup K3S server] *************************************************************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Get k3s installed version] *********************************************************************************************************************************************************************************************************************************************************************************************
fatal: [api.k3s.ujstor.com]: FAILED! => {"changed": false, "cmd": "k3s --version", "msg": "[Errno 2] No such file or directory: b'k3s'", "rc": 2, "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring

TASK [k3s.orchestration.k3s_server : Set k3s installed version] *********************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Download K3s install script] *******************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Download K3s binary] ***************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Add K3s autocomplete to user bashrc] ***********************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Make config directory] *************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Copy config values] ****************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Copy K3s service file [Single]] ****************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Copy K3s service file [HA]] ********************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Add service environment variables] *************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Delete any existing token from the environment if different from the new one] ******************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Add token as an environment variable] **********************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Restart K3s service] ***************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Enable and check K3s service] ******************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Pause to allow first server startup] ***********************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Check whether kubectl is installed on control node] ********************************************************************************************************************************************************************************************************************************************************************
fatal: [api.k3s.ujstor.com -> 127.0.0.1]: FAILED! => {"changed": false, "cmd": "kubectl", "msg": "[Errno 2] No such file or directory: b'kubectl'", "rc": 2, "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring

TASK [k3s.orchestration.k3s_server : Copy k3s.yaml to second file] ******************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Copy kubeconfig to control node] ***************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Change server address in kubeconfig on control node] *******************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Setup kubeconfig context on control node - k3s-ansible] ****************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Merge with any existing kubeconfig on control node] ********************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Wait for token] ********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Read node-token from master] *******************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Store Master node-token] ***********************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Get the token from the first server] ***********************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Delete any existing token from the environment if different from the new one] ******************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Add the token for joining the cluster to the environment] **************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com] => (item=None)
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Copy K3s service file [HA]] ********************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Copy K3s service file [External DB]] ***********************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Restart K3s service] ***************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Enable and check K3s service] ******************************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Verify that all server nodes joined] ***********************************************************************************************************************************************************************************************************************************************************************************
skipping: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Create directory .kube] ************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Copy config file to user home directory] *******************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Configure default KUBECONFIG for user] *********************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [k3s.orchestration.k3s_server : Configure kubectl autocomplete] ****************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

PLAY [Get kubeconfig] ***************************************************************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [api.k3s.ujstor.com]

TASK [Fetch kubeconfig file from remote server] *************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com]

TASK [Replace server IP in kubeconfig] **********************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [api.k3s.ujstor.com -> localhost]

PLAY RECAP **************************************************************************************************************************************************************************************************************************************************************************************************************************************************
api.k3s.ujstor.com         : ok=39   changed=25   unreachable=0    failed=0    skipped=45   rescued=0    ignored=2
```

```bash
root@0ffa9f2d3006:/ansible# cat kubeconfig

apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUzTXpRNU56QTFPRFF3SGhjTk1qUXhNakl6TVRZeE5qSTBXaGNOTXpReE1qSXhNVFl4TmpJMApXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUzTXpRNU56QTFPRFF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTY1AwTVRzcHU5dG15cFcvemZEZGt1Zm1tVkdvY2lXZGZDTGp6RlN1ZjIKRCs5QzZYdUpMSG9XTW4xNEg2eitzdU1UWjJSSVhGeEZBSyt1QVc2MStxUVVvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVVJ6d1hGMTJWQkdLSnl4NEQvSW5sCnZZbk44NnN3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUloQUxnTGFFOVYybzFjeThjbTFJbDc1M0EvRXZiWW4wSEgKYUlKVS9yTzVXSzZtQWlBelBnNE1ibStWdnRyYStHZUJvVE52eFVHL1JER29PRHNPZWlFRDFuZlhBQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://api.k3s.ujstor.com:6443
  name: default
contexts:
- context:
    cluster: default
    user: default
  name: default
current-context: default
kind: Config
preferences: {}
users:
- name: default
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lJYXgwd0VBa1g2SDh3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOek0wT1Rjd05UZzBNQjRYRFRJME1USXlNekUyTVRZeU5Gb1hEVEkxTVRJeQpNekUyTVRZeU5Gb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJKbjIwN0hpRUFvbjFFS1MKWGxxdHptVG5jWG0wb0dRZ3JmK0F0Qjh4SHh5T3NWcnNOMmZCb3M1Q1RHNXVKT0xMeWlTZXVtanRTNnhQQmg1Mwp2N09IenBDalNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCVGxIMXNaaDhYZTZDWmFybG1oTTU0SHF5M2JiREFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlBMWZHYmtaTHMxMU4rMkR5QUhjdW1way9GSlZVaG1BNmdtZXN5WmZaV2JCUUloQUttT253YVZYOXZ3KzJMNgppMnJlbjNZQzI1cFdUd1d3Zno2dmhiSmxyVFpsCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUzTXpRNU56QTFPRFF3SGhjTk1qUXhNakl6TVRZeE5qSTBXaGNOTXpReE1qSXhNVFl4TmpJMApXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUzTXpRNU56QTFPRFF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFRWm5JMjhVSFc5T1BSd0Zjd3FWTHp2TENoS2U0OGNqNGk5Z0l3NHdKNkoKMTFtRVNKUGhxYnZsT0hNVE42QS9JQlNkZWpOZFliL24vZERidExrUExZSFlvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVTVSOWJHWWZGM3VnbVdxNVpvVE9lCkI2c3QyMnd3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU0xSzd6bVpLZTYvQXMvRDdCMzFFQnMrOGN1RHFyWlEKUXhHcnJoSUFwY3BnQWlFQWdtWDN4NERTV2M0VzlyKytpRDBmL2U3T3c4L0xYWXJYSHVXdXRTT1Vjbkk9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUUxS2daTUc0QjkxcXFJWlVHeWxId1k4L1BKS3poZW50RzJoUkxGSGJZOGFvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFbWZiVHNlSVFDaWZVUXBKZVdxM09aT2R4ZWJTZ1pDQ3QvNEMwSHpFZkhJNnhXdXczWjhHaQp6a0pNYm00azRzdktKSjY2YU8xTHJFOEdIbmUvczRmT2tBPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=

```
